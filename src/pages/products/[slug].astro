---
import MainLayout from "../../components/MainLayout.astro";
import "../../style.css";

export async function getStaticPaths() {
  const url =
    "https://klsobzjqbscpapozhswb.supabase.co/rest/v1/Product?apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtsc29iempxYnNjcGFwb3poc3diIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODUzNDE5ODIsImV4cCI6MjAwMDkxNzk4Mn0.elYt1kZI8qijTDQryIWku28K5ky5WiMSnBdACGiLiK0";

  const options = {
    headers: {
      apikey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtsc29iempxYnNjcGFwb3poc3diIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODUzNDE5ODIsImV4cCI6MjAwMDkxNzk4Mn0.elYt1kZI8qijTDQryIWku28K5ky5WiMSnBdACGiLiK0",
    },
  };

  const response = await fetch(url, options);
  const data = await response.json();

  return data.map((product) => ({
    params: { slug: product.id },
    props: { product },
  }));
}

const { product } = Astro.props;
---

<MainLayout>
  <div class="wrapper">
    <div class="carousel images">
      <img class="event-img" src={`/img/${product.product_img_1}`} alt="" draggable="false" />
      <img class="event-img" src={`/img/${product.product_img_2}`} alt="" draggable="false" />
      <img class="event-img" src={`/img/${product.product_img_3}`} alt="" draggable="false" />
    </div>
  </div>
  <h1>{product.product_artist}</h1>
  <p>{product.product_name}</p>
  <p>{product.product_description}</p>
  <p>{product.product_dimensions}</p>
  <p>{product.product_materials}</p>
  <p>{product.product_weight}</p>
  <p>{product.product_price}</p>
  <p>{product.product_category}</p>
</MainLayout>

<style>
  .wrapper .carousel {
    white-space: nowrap;
    cursor: pointer;
    font-size: 0px;
    overflow: hidden;
  }
  .carousel img {
    margin-left: 14px;
  }
  .carousel img:first-child {
    margin-left: 0px;
  }

  .wrapper {
    max-width: 1200px;
  }
  .images {
    display: flex;
  }

  .carousel.dragging {
    cursor: grab;
    scroll-behavior: auto;
  }
  .carousel.dragging img {
    pointer-events: none;
  }
</style>

<script>
  const carousel = document.querySelector(".carousel");
  let firstImg = carousel.querySelectorAll("img")[0];

  let isDragStart = false,
    prevPageX,
    prevScrollLeft,
    positionDiff;

  const dragStart = (e) => {
    isDragStart = true;
    prevPageX = e.pageX || e.touches[0].pageX;
    prevScrollLeft = carousel.scrollLeft;
  };

  const dragging = (e) => {
    if (!isDragStart) return;
    e.preventDefault();
    carousel.classList.add("dragging");
    positionDiff = (e.pageX || e.touches[0].pageX) - prevPageX;
    carousel.scrollLeft = prevScrollLeft - positionDiff;
  };

  const dragStop = () => {
    isDragStart = false;
    carousel.classList.remove("dragging");
  };
  carousel.addEventListener("touchstart", dragStart);
  carousel.addEventListener("touchmove", dragging);
  carousel.addEventListener("mouseup", dragStop);
  carousel.addEventListener("touchend", dragStop);
</script>
